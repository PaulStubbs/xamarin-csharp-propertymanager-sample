---
page_type: sample
products:
- ms-graph
languages:
- csharp
description: "Демонстрирует, как использовать Microsoft Graph в качестве единственного внутреннего компонента для комплексного решения по управлению свойствами"
extensions:
  contentType: samples
  technologies:
  - Microsoft Graph
  platforms:
  - Xamarin
  createdDate: 8/3/2016 8:57:27 AM
---
# Пример диспетчера свойств Microsoft Graph для Xamarin Native

## Содержание

* [Предварительные требования](#prerequisites)
* [Регистрация и настройка приложения](#register-and-configure-the-app)
* [Сборка и отладка](#build-and-debug)
* [Запустите пример](#run-the-sample)
* [Как пример влияет на данные учетной записи](#how-the-sample-affects-your-account-data)
* [Участие](#contributing)
* [Дополнительные ресурсы](#additional-resources)

Этот пример проекта демонстрирует, как использовать Microsoft Graph в качестве единственного внутреннего компонента для комплексного решения по управлению свойствами. В примерах рассматриваются такие функции, как сведения о свойствах, разговоры, файлы и задачи в приложении Xamarin Native.

Цель этого примера - продемонстрировать способность создавать пользовательские интерфейсы и интерфейсы платформы (путем реализации собственных представлений), совместно используя общий код для разных платформ и добавляя решение с помощью Microsoft Graph. Он активно использует группы Office 365 для организации данных в свойства.

> **Примечание**. Пример предназначен для бета-версии Microsoft Graph, которую не реализован в [Microsoft Graph .NET Client SDK](https://github.com/microsoftgraph/msgraph-sdk-dotnet). Вместо этого выполняются сетевые вызовы со встроенным стеком HTTP в сторону Microsoft Graph для использования его ресурсов.

В примерах используется [библиотека аутентификации Microsoft (MSAL)](https://www.nuget.org/packages/Microsoft.Identity.Client) для аутентификации и библиотека [MvvmCross](https://mvvmcross.com/) для переноса шаблона [MVVM](https://msdn.microsoft.com/en-us/library/hh848246.aspx) на платформы с Xamarin.

![Скриншоты образца, работающего на проектах Android, iOS и UWP. ](/Images/PM_OSes.png "Образец работает на Android, iOS и UWP.")

### Project

Project | Авторы
---------|----------
XamarinNativePropertyManager | [Саймон Ягер](http://simonjaeger.com/) (**Microsoft**)

### Журнал версий

| Версия | Дата | Комментарии |
|---------|------|----------|
| 1.0 | 4 августа 2016 | Первоначальный выпуск |
| 1.1 | 4 апреля 2018 года | Обновлено для использования библиотеки MSAL для аутентификации |


## Предварительные требования

Для этого примера требуются приведенные ниже компоненты.  

- [Visual Studio](https://www.visualstudio.com/downloads) 2017 с установленной рабочей нагрузкой [Xamarin](https://www.xamarin.com/visual-studio)
- Windows 10 ([с включенным режимом разработки](https://msdn.microsoft.com/library/windows/apps/xaml/dn706236.aspx)).
-  Учетная запись Office 365 - если вы создаете Office 365 и у вас отсутствует клиент Office 365 - создайте учетную запись разработчика по адресу: https://developer.microsoft.com/en-us/office/dev-program.

Чтобы выполнить проект iOS в этом примере, вам потребуются следующие компоненты:

- Последний пакет SDK для iOS
- Последняя версия Xcode
- Mac OS X Yosemite (10.10) и выше
- [Xamarin.iOS](https://docs.microsoft.com/en-us/xamarin/ios/get-started/installation/mac)

Вы можете использовать [эмулятор Visual Studio для Android](https://www.visualstudio.com/features/msft-android-emulator-vs.aspx), если хотите запустить проект Android.

## Регистрация приложения 
 
1. Перейдите на страницу [регистрации приложений портала Azure](https://go.microsoft.com/fwlink/?linkid=2083908), чтобы зарегистрировать ваше приложение. Войдите с помощью **рабочей или учебной учетной записи**. 
 
2. Выберите **Новая регистрация**. На странице **Регистрация приложения** задайте необходимые значения следующим образом: 
 
* Задайте **Имя** **Xamarin Native PropertyManager**. 
* Задайте для параметра **Поддерживаемые типы учетных записей** значение **Учетные записи в любом каталоге организации**. 
* Оставьте поле **URI перенаправления** пустым. 
* Нажмите кнопку **Зарегистрировать**. 
 
3. На странице **Xamarin Native PropertyManager** скопируйте и сохраните значения **идентификаторов приложения (клиента)** и **идентификатор Directory (код клиента)**. Они понадобятся вам на шаге 7. 
 
4. Выберите **Сертификаты и секреты** в разделе **Управление**. Нажмите кнопку **Новый секрет клиента**. Введите значение в поле **Описание**, выберите любую опцию **Срок действия** и нажмите **Добавить**. 
 
5. Скопируйте секретное значение клиента перед тем, как покинуть страницу. Оно вам понадобится на следующем шаге. 
 
6. Откройте образец решения в Visual Studio и откройте файл **Constants.cs**. Измените строку **клиента** на значение **идентификатора каталога (клиента)**, которое вы скопировали ранее. Аналогичным образом измените строку **ClientIdForAppAuthn** на **значение идентификатора приложения (клиента)** и измените строку **ClientSecret** на секретное значение клиента. 
 
7. Вернитесь в центр управления Azure Active Directory. Выберите **разрешения API**, а затем выберите **Добавить разрешение**. На появившейся панели выберите **Microsoft Graph**, а затем выберите **Права доступа к приложению**. 
 
8. Используйте окно поиска **Выбор разрешений** для поиска следующих разрешений: User.Read, Group.ReadWrite.All, Sites.Read.All, Files.ReadWrite.All, Tasks.ReadWrite, Directory.Read.All. Установите флажок для каждого отображаемого разрешения (обратите внимание, что разрешения скрываются из списка после их выбора). Нажмите кнопку **добавить разрешения** в нижней части панели. 
 
9. Нажмите кнопку **предоставить согласие администратора для \[имя клиента]**. В появившемся диалоговом окне нажмите кнопку **да**, чтобы подтвердить это.

## Сборка и отладка

**Примечание.** Если во время установки пакетов при выполнении шага 2 возникают ошибки, убедитесь, что локальный путь к решению не слишком длинный. Чтобы устранить эту проблему, переместите решение ближе к корню диска.

1. Откройте файл Constants.cs в проекте **XamarinNativePropertyManager (Portable)** проекта решения.

    ![Снимки экрана Constants.csного файла.](/Images/Constants.png "Constants.cs.") 

1. После того как вы загрузили решение в Visual Studio, настройте образец для использования клиента Azure AD, заменив параметр **\[TENANT\_ID\_OR\_NAME]** в свойстве **Authority** в файле **Constants.cs**.

    ![Снимки экрана свойства Authority в файле Constants.cs. ](/Images/TenantId.png "свойства Authority.") 

1. Настройте образец так, чтобы он использовал идентификатор клиента приложения Azure AD, заменяющее значение **\[CLIENT\_ID]** в свойстве **ClientId** в файле **Constants.cs**.

    ![Снимки экрана свойства ClientId в файле ](/Images/ClientId.png "свойства Authority.") 

1. Откройте файл **XamarinNativePropertyManager.Droid/Properties/AndroidManifest.xml** Замените значение `[CLIENT_ID`] вашим идентификатором клиента.

    > **Примечание.** Если вы используете Visual Studio для Mac, обязательно откройте вкладку **Источник** после открытия **AndroidManifest.xml**.

1. Откройте файл **XamarinNativePropertyManager.iOS/Info.plist** Откройте вкладку **расширенные** и найдите раздел **"типы URL-адресов**". Замените `[CLIENT_ID]` своим идентификатором клиента.

    ![Снимок экрана с разделом "Типы URL" файла Info.plist](Images/url_in_info_plist.png)

1. Выберите проект, который следует выполнить. Если вы выбрали проект универсальной платформы Windows, вы должны запустить образец на компьютере с Windows. Если вы хотите запустить проект iOS, вам нужно либо подключиться к [Mac, на котором установлены инструменты Xamarin](https://docs.microsoft.com/en-us/xamarin/ios/get-started/installation/windows/connecting-to-mac/), либо вам необходимо собрать и запустить проект в Visual Studio для Mac. Проект Android можно создавать и запускать на Windows или Mac, если установлен эмулятор Android.

    ![Снимок экрана панели инструментов Visual Studio с выбранным UWP в качестве начального проекта. ](/Images/Projects.png "Выберите стартовый проект.") 

1. Нажмите клавишу F5 для сборки и отладки. Запустите решение и войдите в систему с помощью личной, рабочей или учебной учетной записи.

    > **Примечание** Возможно, вам придется открыть диспетчер конфигурации сборки, чтобы убедиться, что для проекта UWP выбраны этапы сборки и развертывания.

## Запустите пример

После запуска приложения нажмите кнопку **Вход**, чтобы войти в свою учетную запись организации. После аутентификации приложение отображает все свойства в вашей организации. Создайте новый, заполнив детали, и приложение предоставит новую группу Office 365 для этого свойства. На этом этапе вы сможете публиковать сообщения в групповых беседах, добавлять файлы и создавать задачи.

Вы также сможете обновить детали собственности и создавать новые. Изучите группы Office 365 в своем браузере, чтобы найти все данные, используемые в приложении. Сведения о свойствах хранятся в книге Excel с именем **Data.xlsx**, расположенной в группе **Менеджеры свойств**. 

### Скриншоты платформы

#### Android

![Образец, работающий на Android.](Images/PM_Android.png)

#### iOS

![Образец, работающий на Android.](Images/PM_iOS.png)

#### UWP

![Образец, работающий на Android.](Images/PM_UWP1.png)

## Как пример влияет на данные учетной записи

При первом запуске примера (в клиенте Office 365) Группа Office 365 с именем **диспетчеры свойств** создается. В этой группе хранится файл **Data.** xlsx, где хранятся все подробные сведения о различных свойствах.

Для каждого свойства, созданного в приложении, создается новая группа Office 365. В каждой группе ресурсы файлов, разговоров и задач используются приложением. Задачи - это единственное, что можно удалить (выполнить) из приложения. Приложение не предоставляет возможность удалять сообщения беседы или файлы. 

## Участие

Если вы хотите добавить код в этот пример, просмотрите статью [CONTRIBUTING.MD](/CONTRIBUTING.md).

Этот проект соответствует [Правилам поведения разработчиков открытого кода Майкрософт](https://opensource.microsoft.com/codeofconduct/). Дополнительные сведения см. в разделе [вопросов и ответов о правилах поведения](https://opensource.microsoft.com/codeofconduct/faq/). Если у вас возникли вопросы или замечания, напишите нам по адресу [opencode@microsoft.com](mailto:opencode@microsoft.com).

## Дополнительные ресурсы

- [Другие примеры Microsoft Graph Connect](https://github.com/MicrosoftGraph?utf8=%E2%9C%93&query=-Connect)
- [Общие сведения о Microsoft Graph](https://developer.microsoft.com/en-us/graph/docs/concepts/overview)
- [Примеры кода решений для Office](https://developer.microsoft.com/en-us/office/gallery/?filterBy=Samples)
- [Центр разработки для Office](https://developer.microsoft.com/en-us/office)
- [Блог Саймона Ягера на # Office365Dev](http://simonjaeger.com/)

## Авторские права
(c) Корпорация Майкрософт (Microsoft Corporation), 2016. Все права защищены.
